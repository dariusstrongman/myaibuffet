<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sitemap Generator | AI Buffet</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <div style="max-width: 800px; margin: 0 auto; padding: 40px 20px; font-family: 'Inter', sans-serif;">
        <h1>üó∫Ô∏è AI Buffet Sitemap Generator</h1>
        <p>Generate XML sitemap for all RSS articles in your Supabase database.</p>

        <button onclick="generateSitemap()" style="background: #4F46E5; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; margin-bottom: 20px;">
            Generate Sitemap
        </button>

        <div id="status"></div>
        <textarea id="sitemap-output" style="width: 100%; height: 400px; font-family: monospace; font-size: 12px; margin-top: 20px;" placeholder="Generated sitemap will appear here..."></textarea>

        <div style="margin-top: 20px;">
            <button onclick="downloadSitemap()" style="background: #059669; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; margin-right: 10px;">
                Download sitemap.xml
            </button>
            <button onclick="copySitemap()" style="background: #7C3AED; color: white; padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer;">
                Copy to Clipboard
            </button>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://npetaroffoyjohjiwssf.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5wZXRhcm9mZm95am9oaml3c3NmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTcwMDk5OTgsImV4cCI6MjA3MjU4NTk5OH0.oYJ4ETV_zIDx_7KWJlEtcrIrRqy72HYEFzAs37pPzB8';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        async function generateSitemap() {
            const statusDiv = document.getElementById('status');
            const outputTextarea = document.getElementById('sitemap-output');

            try {
                statusDiv.innerHTML = '<p style="color: #059669;">üîÑ Fetching articles from Supabase...</p>';

                // Fetch all articles from Supabase
                const { data: articles, error } = await supabase
                    .from('articles')
                    .select('id, slug, title, pub_date, featured, breaking_news, trending_score')
                    .order('pub_date', { ascending: false });

                if (error) {
                    throw new Error(`Supabase error: ${error.message}`);
                }

                if (!articles || articles.length === 0) {
                    statusDiv.innerHTML = '<p style="color: #DC2626;">‚ö†Ô∏è No articles found in database</p>';
                    return;
                }

                statusDiv.innerHTML = `<p style="color: #059669;">‚úÖ Found ${articles.length} articles. Generating sitemap...</p>`;

                // Generate XML sitemap
                const sitemap = generateXMLSitemap(articles);
                outputTextarea.value = sitemap;

                statusDiv.innerHTML = `
                    <p style="color: #059669;">üéâ Sitemap generated successfully!</p>
                    <ul style="margin-top: 10px; padding-left: 20px;">
                        <li>${articles.length} article URLs</li>
                        <li>Static pages included</li>
                        <li>Priority and changefreq optimized</li>
                    </ul>
                `;

            } catch (error) {
                console.error('Error generating sitemap:', error);
                statusDiv.innerHTML = `<p style="color: #DC2626;">‚ùå Error: ${error.message}</p>`;
            }
        }

        function generateXMLSitemap(articles) {
            const baseURL = 'https://myaibuffet.com';
            const currentDate = new Date().toISOString().split('T')[0];

            let xml = `<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">

    <!-- Static Pages -->
    <url>
        <loc>${baseURL}/</loc>
        <lastmod>${currentDate}</lastmod>
        <changefreq>daily</changefreq>
        <priority>1.0</priority>
    </url>

    <url>
        <loc>${baseURL}/categories/news.html</loc>
        <lastmod>${currentDate}</lastmod>
        <changefreq>hourly</changefreq>
        <priority>0.9</priority>
    </url>

    <url>
        <loc>${baseURL}/categories/tools.html</loc>
        <lastmod>${currentDate}</lastmod>
        <changefreq>daily</changefreq>
        <priority>0.8</priority>
    </url>

    <url>
        <loc>${baseURL}/prompts.html</loc>
        <lastmod>${currentDate}</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
    </url>

    <url>
        <loc>${baseURL}/battle.html</loc>
        <lastmod>${currentDate}</lastmod>
        <changefreq>daily</changefreq>
        <priority>0.7</priority>
    </url>

    <url>
        <loc>${baseURL}/guides/ai-use-cases.html</loc>
        <lastmod>${currentDate}</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.7</priority>
    </url>

    <url>
        <loc>${baseURL}/faq.html</loc>
        <lastmod>${currentDate}</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.6</priority>
    </url>

    <url>
        <loc>${baseURL}/about.html</loc>
        <lastmod>${currentDate}</lastmod>
        <changefreq>monthly</changefreq>
        <priority>0.5</priority>
    </url>

    <!-- Individual Blog Posts -->
    <url>
        <loc>${baseURL}/posts/chatgpt-vs-claude-2025-complete-comparison.html</loc>
        <lastmod>${currentDate}</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
    </url>

    <url>
        <loc>${baseURL}/posts/best-ai-tools-small-business-2025.html</loc>
        <lastmod>${currentDate}</lastmod>
        <changefreq>weekly</changefreq>
        <priority>0.8</priority>
    </url>
`;

            // Add RSS Articles
            xml += `
    <!-- RSS Articles (Auto-Generated from Supabase) -->`;

            articles.forEach(article => {
                const articleUrl = article.slug
                    ? `${baseURL}/article-template.html?id=${article.slug}`
                    : `${baseURL}/article-template.html?id=${article.id}`;

                const lastmod = article.pub_date
                    ? new Date(article.pub_date).toISOString().split('T')[0]
                    : currentDate;

                // Calculate priority based on article characteristics
                let priority = 0.6; // Base priority for news articles

                if (article.featured === 'TRUE' || article.featured === true) priority += 0.1;
                if (article.breaking_news === 'TRUE' || article.breaking_news === true) priority += 0.1;
                if (article.trending_score && article.trending_score > 80) priority += 0.1;

                priority = Math.min(priority, 0.9); // Cap at 0.9

                xml += `
    <url>
        <loc>${articleUrl}</loc>
        <lastmod>${lastmod}</lastmod>
        <changefreq>weekly</changefreq>
        <priority>${priority.toFixed(1)}</priority>
    </url>`;
            });

            xml += `

</urlset>`;

            return xml;
        }

        function downloadSitemap() {
            const sitemap = document.getElementById('sitemap-output').value;
            if (!sitemap) {
                alert('Please generate sitemap first');
                return;
            }

            const blob = new Blob([sitemap], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sitemap.xml';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function copySitemap() {
            const sitemap = document.getElementById('sitemap-output').value;
            if (!sitemap) {
                alert('Please generate sitemap first');
                return;
            }

            navigator.clipboard.writeText(sitemap).then(() => {
                alert('Sitemap copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }

        // Auto-generate on page load for demo
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(generateSitemap, 1000);
        });
    </script>
</body>
</html>